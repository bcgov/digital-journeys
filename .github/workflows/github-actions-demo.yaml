name: GitHub openshift deployment demo
run-name: Apply forms-flow-documents deploymentConfigs on Openshift
on: 
  push:
    # paths:
    #   - "deployment/openshift/documents_api_dc.yaml"
    #   - "deployment/openshift/documents_api_bc.yaml"
  workflow_dispatch:
    inputs:
      environment:
        description: 'Environment'
        required: true
        default: 'dev'
        type: choice
        options:
        - dev
        - test
        - production

jobs:
  #Print variables for logging and debugging purposes
  checkEnv:
    name: Check Env variables
    runs-on: ubuntu-latest
    steps:
      - name: Print Env Vars
        run: |
          echo Git Base Ref: ${{ github.base_ref }}
          echo Git Build ID: ${{ github.event.number }}
          echo Git Pull Request Ref: ${{ github.event.pull_request.head.sha }}
          echo OC CLI Version: $(oc version)



  # Apply buildConfigs on Openshift
  apply-openshift-buildConfigs:
    runs-on: ubuntu-latest
    env:
      BUILD_NAMESPACE: d89793-tools
    steps:
      # Log in to OpenShift.
      # Note: The secrets needed to log in are NOT available if the PR comes from a FORK.
      # PR's must originate from a branch off the original repo or else all openshift `oc` commands will fail.
      - name: Log in to OpenShift
        run: |
          oc login --token=${{ secrets.SA_TOKEN }} --server=https://api.silver.devops.gov.bc.ca:6443

      - name: apply-openshift-buildConfigs
        # working-directory: /deployment/openshift
        run: |
          echo ($pwd)
          # oc -n ${BUILD_NAMESPACE} process -f forms-flow-documents_bc.yaml | oc -n ${BUILD_NAMESPACE} apply -f -